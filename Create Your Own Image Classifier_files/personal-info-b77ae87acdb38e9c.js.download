(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2728],{96171:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/personal-info",function(){return n(21885)}])},42937:function(e,r,n){"use strict";n.d(r,{D:function(){return s}});var t=n(67294),o=n(26793),i=n(4419),a=n(34454),s=function(){var e=(0,o.$)().t,r=(0,i.p)(),n=r.data,s=r.isError,c=r.isLoading,u=r.isSuccess,l=(0,a.V)();return(0,t.useEffect)((function(){s&&l({variant:"error",message:e("error.userLocationError")})}),[l,e,s]),{userLocation:n,userLocationIsLoading:c,userLocationIsSuccess:u}}},21885:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return M}});var t,o=n(34051),i=n.n(o),a=n(85893),s=n(67294),c=n(2962),u=n(26793),l=n(44473),f=n(50514),d=n(83271),v=n(98826),m=n(94184),I=n.n(m),h=n(97235),p=n(59519),b=n(41609),E=n.n(b),N=n(49385),x=n(97522),C=n(62255),V=n(93782),g=n(42937),_=n(54041);!function(e){e.UNVERIFIED="UNVERIFIED",e.VERIFICATION_STARTED="VERIFICATION_STARTED",e.WAITING_FOR_CODE="WAITING_FOR_CODE",e.CODE_VALIDATION_STARTED="CODE_VALIDATION_STARTED",e.WAITING_FOR_VALIDATION="WAITING_FOR_VALIDATION",e.VALIDATION_FAILED="VALIDATION_FAILED",e.VERIFIED="VERIFIED"}(t||(t={}));var D=n(42642),A=function(e){var r=e.onStartVerification,n=e.onCodeChange,o=e.onSubmitVerification,i=e.isCodeValid,s=e.verificationCode,c=e.verificationState,d=(0,u.$)().t;return c===t.VERIFICATION_STARTED?(0,a.jsx)(l.$,{label:d("common.loading")}):(0,a.jsxs)(f.Kq,{spacing:2,children:[(0,a.jsx)(f.kC,{children:(0,a.jsx)(C.zx,{color:"blue.500",variant:"ghost",onClick:r,leftIcon:(0,a.jsx)(D.nyI,{color:"blue.500",w:8,h:8}),children:d("settings.personalInformation.resendCode")})}),(0,a.jsxs)("p",{id:"code-description",children:[d("settings.personalInformation.enterVerificationCode"),":"]}),(0,a.jsxs)(f.kC,{gap:4,children:[(0,a.jsx)(x.II,{type:"text",flex:1,value:s,onChange:n,maxLength:4,"aria-describedby":"code-description","aria-label":d("settings.personalInformation.verifyCode")}),(0,a.jsx)(C.zx,{onClick:o,variant:"solid",disabled:!i,children:d("common.submit")})]})]})},y=function(e){var r=e.isEmailVerified,n=e.verificationState,o=e.isPhoneNumberDeleted,i=(0,u.$)().t;return(0,a.jsxs)(f.Kq,{spacing:2,children:[(0,a.jsxs)(f.kC,{alignItems:"center",children:[n===t.VERIFIED?(0,a.jsx)(D.YJ9,{w:6,h:6,color:"black"}):(0,a.jsx)(D.szr,{w:6,h:6,color:"feedback.warning"}),(0,a.jsx)(f.xv,{children:n===t.VERIFIED?i("settings.personalInformation.mobileVerified"):i(r?"settings.personalInformation.mobileVerificationSent":"settings.personalInformation.emailRequiredBeforeMobile")})]}),(0,a.jsxs)(f.kC,{alignItems:"center",children:[!o&&n===t.VERIFIED&&(0,a.jsx)(D.szr,{w:6,h:6,color:"feedback.warning"}),(0,a.jsx)(f.xv,{color:"gray.900",children:n===t.VERIFIED&&i("settings.personalInformation.mobileDeleteOption")})]})]})};n(15922);function T(e,r,n,t,o,i,a){try{var s=e[i](a),c=s.value}catch(u){return void n(u)}s.done?r(c):Promise.resolve(c).then(t,o)}function P(e){return function(){var r=this,n=arguments;return new Promise((function(t,o){var i=e.apply(r,n);function a(e){T(i,t,o,a,s,"next",e)}function s(e){T(i,t,o,a,s,"throw",e)}a(void 0)}))}}var O=function(e){var r=e.phoneNotificationHandlers,n=e.startPhoneNumberVerification,o=e.verifyPhoneNumber,c=e.onPhoneVerificationSuccess,l=e.deletePhoneNumber,d=e.savedPhoneNumber,v=e.userKey,m=e.isEmailVerified,b=e.verified,D=(0,u.$)(),T=D.t,O=D.i18n,S=(0,s.useState)(d),k=S[0],R=S[1],j=(0,s.useState)(b?t.VERIFIED:t.UNVERIFIED),w=j[0],F=j[1],U=(0,s.useState)(!1),L=U[0],K=U[1],G=(0,s.useState)(!1),q=G[0],W=G[1],$=(0,V.p)(""),z=$.value,M=$.reset,X=(0,g.D)().userLocation;(0,s.useEffect)((function(){R(d),M()}),[M,d]);var B=(0,s.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=w;e!==d?r=t.UNVERIFIED:b&&(r=t.VERIFIED),R(e),K(!1),F(r),M()}),[M,d,R,F,w,b]);(0,s.useEffect)((function(){var e=4===z.length;W(e)}),[z]);var H=(0,s.useCallback)(function(){var e=P(i().mark((function e(o){var a,s,c,u,l,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=2;break}return e.abrupt("return");case 2:return o.preventDefault(),a=(0,p._)(k||""),F(t.VERIFICATION_STARTED),e.next=8,n({userKey:v,countryCode:null!==(s=null===a||void 0===a?void 0:a.countryCallingCode.toString())&&void 0!==s?s:"",phoneNumber:null!==(c=null===a||void 0===a?void 0:a.nationalNumber.toString())&&void 0!==c?c:"",locale:O.language});case 8:u=e.sent,l=u.success,f=u.error,l?F(t.WAITING_FOR_CODE):(F(t.UNVERIFIED),("InvalidPhoneNumberOrCountryCode"===f||"TooManyVerificationRequests"===f?r.error[f]:r.error.VerificationCodeGenerationDefault)());case 12:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[O.language,k,r.error,n,v]),J=(0,s.useCallback)(P(i().mark((function e(){var n,a,s,u,l,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=2;break}return e.abrupt("return");case 2:return n=(0,p._)(k||""),F(t.CODE_VALIDATION_STARTED),e.next=7,o({userKey:v,verificationCode:z,countryCode:null!==(a=null===n||void 0===n?void 0:n.countryCallingCode.toString())&&void 0!==a?a:"",phoneNumber:null!==(s=null===n||void 0===n?void 0:n.nationalNumber.toString())&&void 0!==s?s:""});case 7:u=e.sent,l=u.success,f=u.error,l&&k?(F(t.VERIFIED),K(!1),M(),c(k),r.success.verification()):(F(t.VALIDATION_FAILED),("IncorrectVerificationCode"===f?r.error.IncorrectVerificationCode:r.error.VerificationCodeValidationDefault)());case 11:case"end":return e.stop()}}),e)}))),[k,c,r,M,v,z,o]),Y=(0,s.useCallback)(P(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l(),r.success.deletion(),F(t.UNVERIFIED);case 3:case"end":return e.stop()}}),e)}))),[r,l]),Z=!1;k&&(Z=(0,N.yf)(k));var Q=w===t.VERIFIED,ee=[t.VERIFICATION_STARTED,t.WAITING_FOR_CODE,t.CODE_VALIDATION_STARTED,t.WAITING_FOR_VALIDATION,t.VALIDATION_FAILED].includes(w),re=T("common.sendCode");return ee?re=T("common.verifying"):Q&&(re=T("common.verified")),(0,a.jsx)(_.w,{title:T("common.phoneNumber"),children:(0,a.jsxs)(f.Kq,{spacing:2,children:[(0,a.jsxs)(f.kC,{gap:4,children:[(null===X||void 0===X?void 0:X.countryCode)&&(0,a.jsx)(N.ZP,{style:{flex:1},flags:h.ZP,"aria-label":T("common.phoneNumber"),placeholder:T("common.phoneNumber"),inputComponent:x.II,numberInputProps:{className:I()({"error-field":!Z&&!E()(k)})},defaultCountry:X.countryCode,value:k,onChange:B}),(0,a.jsx)(C.zx,{onClick:H,disabled:!Z||Q||ee||!m,children:re}),(0,a.jsx)(C.zx,{onClick:Y,colorScheme:"red",disabled:!d,children:T("common.delete")})]}),ee?(0,a.jsx)(A,{isCodeValid:q,verificationCode:z,verificationState:w,onStartVerification:H,onCodeChange:$.handleChange,onSubmitVerification:J}):(0,a.jsx)(y,{isEmailVerified:m,verificationState:w,isPhoneNumberDeleted:L})]})})},S=n(59834),k=n(34454),R=n(90513),j=n(84513),w=n(24435),F=n(27361),U=n.n(F),L=n(63686);function K(e,r,n,t,o,i,a){try{var s=e[i](a),c=s.value}catch(u){return void n(u)}s.done?r(c):Promise.resolve(c).then(t,o)}function G(e){return function(){var r=this,n=arguments;return new Promise((function(t,o){var i=e.apply(r,n);function a(e){K(i,t,o,a,s,"next",e)}function s(e){K(i,t,o,a,s,"throw",e)}a(void 0)}))}}var q="/api/notification-preferences",W={startPhoneNumberVerification:function(e){return G(i().mark((function r(){var n,t,o,a,s;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.userKey,t=e.locale,o=e.countryCode,a=e.phoneNumber,r.prev=1,r.next=4,(0,L.v_)("".concat(q,"/users/").concat(n,"/verify/start"),{country_code:o,phone_number:a,locale:t});case 4:return s=r.sent,r.abrupt("return",{success:200===s.status,error:null});case 8:return r.prev=8,r.t0=r.catch(1),console.error(r.t0),r.abrupt("return",{success:!1,error:U()(r.t0,"data.error.reason","Unknown")});case 12:case"end":return r.stop()}}),r,null,[[1,8]])})))()},verifyPhoneNumber:function(e){return G(i().mark((function r(){var n,t,o,a,s;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.userKey,t=e.verificationCode,o=e.countryCode,a=e.phoneNumber,r.prev=1,r.next=4,(0,L.v_)("".concat(q,"/users/").concat(n,"/verify/check"),{country_code:o,phone_number:a,verification_code:t});case 4:return s=r.sent,r.abrupt("return",{success:200===s.status,error:null});case 8:return r.prev=8,r.t0=r.catch(1),console.error(r.t0),r.abrupt("return",{success:!1,error:U()(r.t0,"data.error.reason","Unknown")});case 12:case"end":return r.stop()}}),r,null,[[1,8]])})))()}};function $(e,r,n,t,o,i,a){try{var s=e[i](a),c=s.value}catch(u){return void n(u)}s.done?r(c):Promise.resolve(c).then(t,o)}function z(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var M=function(){var e=(0,k.V)(),r=(0,j.a)(),n=r.user,t=r.requestEmailVerification,o=r.updateUserEmail,m=r.updateUserPhoneNumberIsSuccess,I=r.updateUserPhoneNumber,h=r.updateInputUser,p=(0,S.r)(),b=(0,u.$)().t,E=(0,R.k)(),N=E.photoUrl,x=E.postUserProfile,C=(0,s.useMemo)((function(){if(n){var e=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),t.forEach((function(r){z(e,r,n[r])}))}return e}({},n,{isPhoneNumberVerified:!(null===n.phoneNumber||!n.isPhoneNumberVerified),photoUrl:null!==N&&void 0!==N?N:""});return e}}),[n,N]),V=(0,s.useMemo)((function(){return(0,v.gS)((function(r){return e({variant:"success",message:r})}),(function(r){return e({variant:"error",message:r})}),b)}),[e,b]),g=(0,s.useCallback)(function(){var e,r=(e=i().mark((function e(r,n,t){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={first_name:"",last_name:"",preferred_language:""},r.firstName!==(null===C||void 0===C?void 0:C.firstName)&&(a.first_name=r.firstName),r.lastName!==(null===C||void 0===C?void 0:C.lastName)&&(a.last_name=r.lastName),!a.first_name&&!a.last_name){e.next=6;break}return e.next=6,h(a);case 6:if(!n){e.next=9;break}return e.next=9,o({email:n.email,password:n.password});case 9:if(t&&m&&C&&(C.isPhoneNumberVerified=!1,I("")),r.photoUrl===(null===C||void 0===C?void 0:C.photoUrl)){e.next=24;break}return p.setPhotoAlert(p.STATUS.PROCESSING),e.prev=12,e.next=15,x(r.photoUrl);case 15:p.setPhotoAlert({variant:"success",message:b("settings.personalInformation.successfullyUpdatedPhoto")}),(0,w.j)("Uploaded Avatar",{user_id:null===C||void 0===C?void 0:C.id}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(12),p.setPhotoAlert({variant:"error",message:b("settings.personalInformation.errorUpdatingPhoto")});case 22:e.next=25;break;case 24:p.setPhotoAlert(p.STATUS.EMPTY);case 25:case"end":return e.stop()}}),e,null,[[12,19]])})),function(){var r=this,n=arguments;return new Promise((function(t,o){var i=e.apply(r,n);function a(e){$(i,t,o,a,s,"next",e)}function s(e){$(i,t,o,a,s,"throw",e)}a(void 0)}))});return function(e,n,t){return r.apply(this,arguments)}}(),[p,x,C,b,h,o,I,m]),_=(0,s.useCallback)((function(e){I(e)}),[I]),D=(0,s.useCallback)((function(){C&&(g(C,void 0,!0),I(""))}),[g,C,I]);return(0,s.useEffect)((function(){(0,w.Md)("Personal Info")}),[]),C?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.PB,{title:b("settings.personalInformation.pageTitle")}),(0,a.jsx)(d.X,{children:(0,a.jsx)(v.dU,{children:(0,a.jsxs)(f.Kq,{spacing:12,children:[(0,a.jsx)(v.B5,{user:C,onSubmit:g,onEmailVerificationRequest:t}),(0,a.jsx)(O,{userKey:C.id,savedPhoneNumber:C.phoneNumber,verified:C.isPhoneNumberVerified,isEmailVerified:!!C.isEmailVerified,phoneNotificationHandlers:V,onPhoneVerificationSuccess:_,deletePhoneNumber:D,startPhoneNumberVerification:W.startPhoneNumberVerification,verifyPhoneNumber:W.verifyPhoneNumber}),(0,a.jsx)(v.XJ,{})]})})})]}):(0,a.jsx)(l.$,{})}}},function(e){e.O(0,[2678,3817,5006,6940,2579,3685,2962,2012,2610,6183,4098,3271,8826,9774,2888,179],(function(){return r=96171,e(e.s=r);var r}));var r=e.O();_N_E=r}]);